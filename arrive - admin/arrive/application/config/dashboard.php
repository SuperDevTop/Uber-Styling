<?php
//echo'<pre>';
//print_r(PHP_VERSION);
//die();
$sessionData = $this->session->userdata();
?>

<div class="page-content">
    <div class="container-fluid">

        <div class="row">
            <div class="col-xl-6">
                <div class="chart-statistic-box">
                    <div class="chart-txt">
                        <div class="chart-txt-top">
                            <p><span class="unit">$</span><span class="number">1540</span></p>
                            <p class="caption">Week income</p>
                        </div>
                        <table class="tbl-data">
                            <tbody><tr>
                                    <td class="price color-purple">120$</td>
                                    <td>Orders</td>
                                </tr>
                                <tr>
                                    <td class="price color-yellow">15$</td>
                                    <td>Investments</td>
                                </tr>
                                <tr>
                                    <td class="price color-lime">55$</td>
                                    <td>Others</td>
                                </tr>
                            </tbody></table>
                    </div>
                    <div class="chart-container">
                        <div class="chart-container-in">
                            <div id="chart_div"><div style="position: relative;"><div dir="ltr" style="position: relative; width: 285px; height: 314px;"><div aria-label="A chart." style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%;"><svg width="285" height="314" aria-label="A chart." style="overflow: hidden;"><defs id="defs"><clipPath id="_ABSTRACT_RENDERER_ID_4"><rect x="0" y="0" width="285" height="314"></rect></clipPath></defs><rect x="0" y="0" width="285" height="314" stroke="none" stroke-width="0" fill="#008ffb"></rect><g><rect x="0" y="0" width="285" height="314" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g clip-path="url(file:///var/www/html/airtasker/application/theme/themeforest-15228250-startui-premium-bootstrap-4-admin-dashboard-template/build/index.html#_ABSTRACT_RENDERER_ID_4)"><g><rect x="0" y="313" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="291" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="268" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="246" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="224" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="201" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="179" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="157" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="134" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="112" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="89" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="67" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="45" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="22" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect><rect x="0" y="0" width="285" height="1" stroke="none" stroke-width="0" fill="#1ba0fc"></rect></g><g><g><path d="M0.5,313.5L0.5,313.5L0.5,197.24285714285713L36,197.24285714285713L71.5,152.52857142857144L107,157L142.5,134.64285714285714L178,161.4714285714286L213.5,89.92857142857144L249,116.75714285714287L284.5,116.75714285714287L284.5,313.5L284.5,313.5Z" stroke="none" stroke-width="0" fill-opacity="0.18" fill="#ffffff"></path></g></g><g><rect x="0" y="313" width="285" height="1" stroke="none" stroke-width="0" fill="#16b4fc"></rect></g><g><path d="M0.5,197.24285714285713L36,197.24285714285713L71.5,152.52857142857144L107,157L142.5,134.64285714285714L178,161.4714285714286L213.5,89.92857142857144L249,116.75714285714287L284.5,116.75714285714287" stroke="#ffffff" stroke-width="2" fill-opacity="1" fill="none"></path></g></g><g><circle cx="0.5" cy="197.24285714285713" r="3.5" stroke="none" stroke-width="0" fill="#ffffff"></circle><circle cx="36" cy="197.24285714285713" r="3.5" stroke="none" stroke-width="0" fill="#ffffff"></circle><circle cx="71.5" cy="152.52857142857144" r="3.5" stroke="none" stroke-width="0" fill="#ffffff"></circle><circle cx="107" cy="157" r="3.5" stroke="none" stroke-width="0" fill="#ffffff"></circle><circle cx="142.5" cy="134.64285714285714" r="3.5" stroke="none" stroke-width="0" fill="#ffffff"></circle><circle cx="178" cy="161.4714285714286" r="3.5" stroke="none" stroke-width="0" fill="#ffffff"></circle><circle cx="213.5" cy="89.92857142857144" r="3.5" stroke="none" stroke-width="0" fill="#ffffff"></circle><circle cx="249" cy="116.75714285714287" r="3.5" stroke="none" stroke-width="0" fill="#ffffff"></circle><circle cx="284.5" cy="116.75714285714287" r="3.5" stroke="none" stroke-width="0" fill="#ffffff"></circle></g></g><g></g></svg><div aria-label="A tabular representation of the data in the chart." style="position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden;"><table><thead><tr><th>Day</th><th>Values</th></tr></thead><tbody><tr><td>MON</td><td>130</td></tr><tr><td>TUE</td><td>130</td></tr><tr><td>WED</td><td>180</td></tr><tr><td>THU</td><td>175</td></tr><tr><td>FRI</td><td>200</td></tr><tr><td>SAT</td><td>170</td></tr><tr><td>SUN</td><td>250</td></tr><tr><td>MON</td><td>220</td></tr><tr><td>TUE</td><td>220</td></tr></tbody></table></div></div></div><div aria-hidden="true" style="display: none; position: absolute; top: 324px; left: 295px; white-space: nowrap; font-family: &quot;Proxima Nova&quot;; font-size: 11px; font-weight: bold;">...</div><div></div></div></div>
                            <header class="chart-container-title">Income</header>
                            <div class="chart-container-x">
                                <div class="item"></div>
                                <div class="item">tue</div>
                                <div class="item">wed</div>
                                <div class="item">thu</div>
                                <div class="item">fri</div>
                                <div class="item">sat</div>
                                <div class="item">sun</div>
                                <div class="item">mon</div>
                                <div class="item"></div>
                            </div>
                            <div class="chart-container-y">
                                <div class="item">300</div>
                                <div class="item"></div>
                                <div class="item">250</div>
                                <div class="item"></div>
                                <div class="item">200</div>
                                <div class="item"></div>
                                <div class="item">150</div>
                                <div class="item"></div>
                                <div class="item">100</div>
                                <div class="item"></div>
                                <div class="item">50</div>
                                <div class="item"></div>
                            </div>
                        </div>
                    </div>
                </div><!--.chart-statistic-box-->
            </div><!--.col-->
            <div class="col-xl-6">
                <div class="row">

                    <div class="col-sm-6">
                        <article class="statistic-box red">
                            <div>
                                <div class="number"><?php echo $userCount['userCount'] ?></div>
                                <div class="caption"><div><a style="color: #fff" href="<?php echo site_url('admin/user/index') ?>">User</a></div></div>

                            </div>
                        </article>

                    </div><!--.col-->
                    <div class="col-sm-6">
                        <article class="statistic-box purple">
                            <div>
                                <div class="number"><?php echo $driverCount['driverCount'] ?></div>
                                <div class="caption"><div><a style="color: #fff" href="<?php echo site_url('admin/driver/index') ?>">Driver</a></div></div>

                            </div>
                        </article>

                    </div><!--.col-->
                    <!--                    <div class="col-sm-6">
                                            <article class="statistic-box purple">
                                                <div>
                                                    <div class="number"><?php echo $bookingCount['bookingCount'] ?></div>
                                                    <div class="caption"><div><a style="color: #fff" href="<?php echo site_url('admin/booking/index') ?>">Booking</a></div></div>

                                                </div>
                                            </article>
                                        </div>-->
                    <!--                    <div class="col-sm-6">
                                            <article class="statistic-box yellow">
                                                <div>
                                                    <div class="number"><?php // echo $vehicleCount['vehicleCount']     ?></div>
                                                    <div class="caption"><div><a style="color: #fff" href="<?php // echo site_url('admin/vehicle/index')     ?>">Vehicle</a></div></div>

                                                </div>
                                            </article>

                                        </div>.col
                                        <div class="col-sm-6">
                                            <article class="statistic-box green">
                                                <div>
                                                    <div class="number"><?php // echo $avatarCount['avatarCount']     ?></div>
                                                    <div class="caption"><div><a style="color: #fff" href="<?php // echo site_url('admin/avatar/index')     ?>">Avatar</a></div></div>

                                                </div>
                                            </article>

                                        </div>.col-->


                </div><!--.row-->
            </div><!--.col-->
        </div>



        <!--        <div class="row">
                    <div class="col-xl-6 dahsboard-column lobipanel-parent-sortable ui-sortable" data-lobipanel-child-inner-id="IDKLC8oXuB 809E0GymwC">
                        <section class="box-typical box-typical-dashboard panel panel-default scrollable lobipanel lobipanel-sortable" data-inner-id="IDKLC8oXuB" data-index="0">
                            <header class="box-typical-header panel-heading ui-sortable-handle">
                                <h3 class="panel-title">Recent orders</h3>
                                <div class="dropdown"><ul class="dropdown-menu dropdown-menu-right"><li><a data-func="editTitle" data-tooltip="Edit title" data-original-title="" title=""><i class="panel-control-icon glyphicon glyphicon-pencil"></i><span class="control-title">Edit title</span></a></li><li><a data-func="unpin" data-tooltip="Unpin"><i class="panel-control-icon glyphicon glyphicon-move"></i><span class="control-title">Unpin</span></a></li><li><a data-func="reload" data-tooltip="Reload"><i class="panel-control-icon glyphicon glyphicon-refresh"></i><span class="control-title">Reload</span></a></li><li><a data-func="minimize" data-tooltip="Minimize"><i class="panel-control-icon glyphicon glyphicon-minus"></i><span class="control-title">Minimize</span></a></li><li><a data-func="expand" data-tooltip="Fullscreen"><i class="panel-control-icon glyphicon glyphicon-resize-full"></i><span class="control-title">Fullscreen</span></a></li><li><a data-func="close" data-tooltip="Close"><i class="panel-control-icon glyphicon glyphicon-remove"></i><span class="control-title">Close</span></a></li></ul><div class="dropdown-toggle" data-toggle="dropdown"><span class="panel-control-icon glyphicon glyphicon-cog"></span></div></div></header>
                            <div class="box-typical-body panel-body jspScrollable" tabindex="0" style="overflow: hidden; padding: 0px; width: 452.5px;">

                                <div class="jspContainer" style="width: 452.5px; height: 264px;"><div class="jspPane" style="padding: 0px; top: -159px; width: 440.5px;"><table class="tbl-typical">
                                            <tbody><tr>
                                                    <th><div>Status</div></th>
                                                    <th><div>Clients</div></th>
                                                    <th align="center"><div>Orders#</div></th>
                                                    <th align="center"><div>Date</div></th>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span class="label label-primary">Paid</span>
                                                        <span class="label label-success">Active</span>
                                                    </td>
                                                    <td>John Doe</td>
                                                    <td align="center">3435362</td>
                                                    <td class="color-blue-grey" nowrap="" align="center"><span class="semibold">Today</span> 8:30</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span class="label label-primary">Paid</span>
                                                        <span class="label label-success">Active</span>
                                                    </td>
                                                    <td>Thomas Bayer</td>
                                                    <td align="center">3435362</td>
                                                    <td class="color-blue-grey" nowrap="" align="center"><span class="semibold">Today</span> 16:30</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span class="label label-primary">Paid</span>
                                                        <span class="label label-default">Inactive</span>
                                                    </td>
                                                    <td>Nicolas Karabat</td>
                                                    <td align="center">3435362</td>
                                                    <td class="color-blue-grey" nowrap="" align="center"><span class="semibold">Yesterday</span></td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span class="label label-default">Unpaid</span>
                                                        <span class="label label-default">Inactive</span>
                                                    </td>
                                                    <td>Alexandre Pome</td>
                                                    <td align="center">3435362</td>
                                                    <td class="color-blue-grey" nowrap="" align="center">23th May</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span class="label label-primary">Paid</span>
                                                        <span class="label label-success">Active</span>
                                                    </td>
                                                    <td>John Doe</td>
                                                    <td align="center">3435362</td>
                                                    <td class="color-blue-grey" nowrap="" align="center"><span class="semibold">Today</span> 8:30</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span class="label label-primary">Paid</span>
                                                        <span class="label label-success">Active</span>
                                                    </td>
                                                    <td>Thomas Bayer</td>
                                                    <td align="center">3435362</td>
                                                    <td class="color-blue-grey" nowrap="" align="center"><span class="semibold">Today</span> 16:30</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span class="label label-primary">Paid</span>
                                                        <span class="label label-default">Inactive</span>
                                                    </td>
                                                    <td>Nicolas Karabat</td>
                                                    <td align="center">3435362</td>
                                                    <td class="color-blue-grey" nowrap="" align="center"><span class="semibold">Yesterday</span></td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <span class="label label-default">Unpaid</span>
                                                        <span class="label label-default">Inactive</span>
                                                    </td>
                                                    <td>Alexandre Pome</td>
                                                    <td align="center">3435362</td>
                                                    <td class="color-blue-grey" nowrap="" align="center">23th May</td>
                                                </tr>
                                            </tbody></table></div><div class="jspVerticalBar"><div class="jspCap jspCapTop"></div><div class="jspTrack" style="height: 264px;"><div class="jspDrag" style="height: 119px; top: 70.1892px;"><div class="jspDragTop"></div><div class="jspDragBottom"></div></div></div><div class="jspCap jspCapBottom"></div></div></div></div>.box-typical-body
                        </section>.box-typical-dashboard

                    </div>

                </div>-->

<div class="row col-lg-12 card " style="width: 100%; min-height: 400px;padding: 0;margin: 0;">
            <h3 class="card-header primary-color white-text">Online Drivers</h3>
            <div class="card-body" id="map" style="width: 100%; height: 375px;">

            </div>
        </div> 

    </div><!--.container-fluid-->
</div><!--.page-content-->
<script src="https://maps.googleapis.com/maps/api/js?key=<?php echo $this->config->item('google_api_key') ?>"
async defer></script>
<script>
    var map;
    window.eqfeed_callback = function (results) {
        results.forEach(function (element) {
            var coords = [
                parseFloat(element.latitude), parseFloat(element.longitude)
            ];
            var latlng = new google.maps.LatLng(
                    parseFloat(coords[0]),
                    parseFloat(coords[1]));
            var image = 'http://13.127.113.110/assets/Sedan_sport.png';

            var marker = new google.maps.Marker({
                position: latlng,
                map: map,
                icon: image,
                size: new google.maps.Size(20, 32),
//                label: element.first_name.charAt(0).toUpperCase() + ' ' + element.last_name.charAt(0).toUpperCase(),
                animation: google.maps.Animation.DROP,
                title: element.first_name + ' ' + element.last_name + ' | ' + element.driving_licence_code + ' ' + element.vechile_reg
            });

            var infowindow = new google.maps.InfoWindow({
                content: '<b>'+element.first_name.toUpperCase() + ' ' + element.last_name.toUpperCase() + '</b> | <b><i>' + element.driving_licence_code + ' ' + element.vechile_reg + '</i></b>'
            });
            marker.addListener('click', function () {

                infowindow.open(map, this);
                if (marker.getAnimation() !== null) {
                    marker.setAnimation(null);
                } else {
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                }
            });
        });
    }
    function toggleBounce() {
        if (marker.getAnimation() !== null) {
            marker.setAnimation(null);
        } else {
            marker.setAnimation(google.maps.Animation.BOUNCE);
        }
    }

    function getDrivers() {
        $.ajax({
            url: "<?php echo base_url() . 'admin/admin/getAllDrivers' ?>",
            type: "post",
            data: {

            },
            success: function (d) { 
                var myLatLng = {lat: 28.58103, lng: 77.3152901};
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 15,
                    center: myLatLng,
                    mapTypeId: 'roadmap'
                });
                eqfeed_callback(d);
            },
            error: function (e) {
                $('#notification').text(JSON.stringify(e));
            }
        });
    }

    $(document).ready(function () {
//        google.load('visualization', '1.0', {'packages': ['corechart'], 'callback': drawCharts});
        setInterval(function () {
            getDrivers();
        }, 60000);
        getDrivers();
    });
</script>

